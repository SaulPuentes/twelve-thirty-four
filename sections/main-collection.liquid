{%- comment -%}
  Main Collection Section
  Three-column layout: Designers (collections) | Product Grid | Categories
{%- endcomment -%}

<script
  src="{{ 'results-list.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>
<script
  src="{{ 'product-card.js' | asset_url }}"
  defer
></script>

<section
  id="MainCollection-{{ section.id }}"
  class="main-collection"
  style="
    --padding-block-start: {{ section.settings.padding_top }}px;
    --padding-block-end: {{ section.settings.padding_bottom }}px;
    --product-columns: {{ section.settings.products_per_row }};
    --product-gap: {{ section.settings.product_gap }}px;
  "
>
  <div class="main-collection__container">
    {%- comment -%} Left Sidebar - Designers (Collections) {%- endcomment -%}
    <aside class="main-collection__sidebar main-collection__sidebar--left">
      <h3 class="main-collection__sidebar-title">{{ section.settings.designers_title | default: 'Designers' }}</h3>
      <nav class="main-collection__nav">
        <ul class="main-collection__nav-list">
          {%- comment -%} ALL option {%- endcomment -%}
          <li class="main-collection__nav-item">
            <a
              href="/collections/all"
              class="main-collection__nav-link{% if collection.handle == 'all' %} main-collection__nav-link--active{% endif %}"
>
              ALL
            </a>
          </li>
          {%- for collection_item in collections -%}
            {%- if collection_item.products.size > 0 -%}
              <li class="main-collection__nav-item">
                <a
                  href="{{ collection_item.url }}"
                  class="main-collection__nav-link{% if collection_item.handle == collection.handle %} main-collection__nav-link--active{% endif %}"
  >
                  {{ collection_item.title }}
                </a>
              </li>
            {%- endif -%}
          {%- endfor -%}
        </ul>
      </nav>
    </aside>

    {%- comment -%} Main Content - Product Grid {%- endcomment -%}
    <div class="main-collection__content">
      {%- assign products_per_page = section.settings.products_per_page | default: 24 -%}

      {%- paginate collection.products by products_per_page -%}
        {%- if collection.products.size > 0 -%}
          <ul class="main-collection__grid" id="ProductGrid">
            {%- for product in collection.products -%}
              {%- if product.available or settings.show_unavailable_products -%}
                <li class="main-collection__grid-item">
                  {%- render 'product-card',
                    product: product,
                    show_add_to_cart: true,
                    image_sizes: '(max-width: 749px) 50vw, 25vw',
                    lazy_load: true
                  -%}
                </li>
              {%- endif -%}
            {%- endfor -%}
          </ul>

          {%- if paginate.pages > 1 -%}
            <div class="main-collection__pagination">
              {{ paginate | default_pagination }}
            </div>
          {%- endif -%}
        {%- else -%}
          <div class="main-collection__empty">
            <p>{{ 'collections.general.no_matches' | t }}</p>
          </div>
        {%- endif -%}
      {%- endpaginate -%}
    </div>

    {%- comment -%} Right Sidebar - Categories {%- endcomment -%}
    <aside class="main-collection__sidebar main-collection__sidebar--right">
      <h3 class="main-collection__sidebar-title">{{ section.settings.categories_title | default: 'Categories' }}</h3>
      
      {%- comment -%} Fetch the Category filter {%- endcomment -%}
      {%- assign category_filter = collection.filters | where: "label", "Browse" | first -%}
      
      {% if category_filter %}
        <nav class="main-collection__nav">
          <ul class="main-collection__nav-list">
             <li class="main-collection__nav-item">
                <a href="{{ collection.url }}" class="main-collection__nav-link {% if category_filter.active_values.size == 0 %}main-collection__nav-link--active{% endif %}">ALL</a>
             </li>
             
             {%- for value in category_filter.values -%}
                {%- if value.count > 0 or value.active -%}
                  <li class="main-collection__nav-item">
                    <a
                      href="{{ value.url_to_add }}"
                      class="main-collection__nav-link {% if value.active %}main-collection__nav-link--active{% endif %}"
                    >
                      {{ value.label }}
                    </a>
                  </li>
                {%- endif -%}
             {%- endfor -%}
          </ul>
        </nav>
      {% else %}
        <p style="font-size: 12px; opacity: 0.6;">
          Admin setup required: Add "Category" filter in Search & Discovery app.
        </p>
      {% endif %}
    </aside>
  </div>
</section>

{% stylesheet %}
  .main-collection {
    padding: var(--padding-block-start, 2rem) 1rem var(--padding-block-end, 2rem);
    background-color: var(--color-background, #fff);
  }

  @media screen and (min-width: 990px) {
    .main-collection {
      padding: var(--padding-block-start, 3rem) 2rem var(--padding-block-end, 3rem);
    }
  }

  .main-collection__container {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
    max-width: 1600px;
    margin: 0 auto;
  }

  @media screen and (min-width: 990px) {
    .main-collection__container {
      grid-template-columns: 180px 1fr 180px;
    }
  }

  /* Sidebars */
  .main-collection__sidebar {
    display: none;
  }

  @media screen and (min-width: 990px) {
    .main-collection__sidebar {
      display: block;
      position: sticky;
      top: calc(var(--header-height, 80px) + 2rem);
      height: fit-content;
      max-height: calc(100vh - var(--header-height, 80px) - 4rem);
      overflow-y: auto;
      /* Hide scrollbar while maintaining scroll functionality */
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE and Edge */
    }

    .main-collection__sidebar::-webkit-scrollbar {
      display: none; /* Chrome, Safari, Opera */
    }
  }

  .main-collection__sidebar-title {
    font-family: var(--font-body-family);
    font-size: 0.75rem;
    font-weight: 400;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin: 0 0 1.5rem 0;
    color: var(--color-foreground);
    opacity: 0.6;
  }

  .main-collection__nav-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .main-collection__nav-item {
    margin-bottom: 0.75rem;
  }

  .main-collection__nav-link {
    font-family: var(--font-body-family);
    font-size: 0.875rem;
    font-weight: 400;
    color: var(--color-foreground);
    text-decoration: none;
    opacity: 0.7;
    transition: opacity 0.3s ease;
  }

  .main-collection__nav-link:hover,
  .main-collection__nav-link--active {
    opacity: 1;
  }

  .main-collection__nav-link--active {
    font-weight: 500;
  }

  /* Main Content */
  .main-collection__content {
    min-width: 0;
  }

  /* Product Grid */
  .main-collection__grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--product-gap, 1.5rem);
    list-style: none;
    margin: 0;
    padding: 0;
  }

    @media screen and (min-width: 750px) {
    .main-collection__grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media screen and (min-width: 990px) {
    .main-collection__grid {
      grid-template-columns: repeat(var(--product-columns, 3), 1fr);
    }
  }

  .main-collection__grid-item {
    position: relative;
    opacity: 0;
    animation: fadeInUp 0.6s var(--animation-easing, ease) both;
  }

  /* Fade sequence animation for first items */
  .main-collection__grid-item:nth-child(1) {
    animation-delay: 0.05s;
  }

  .main-collection__grid-item:nth-child(2) {
    animation-delay: 0.1s;
  }

  .main-collection__grid-item:nth-child(3) {
    animation-delay: 0.15s;
  }

  .main-collection__grid-item:nth-child(4) {
    animation-delay: 0.2s;
  }

  .main-collection__grid-item:nth-child(5) {
    animation-delay: 0.25s;
  }

  .main-collection__grid-item:nth-child(6) {
    animation-delay: 0.3s;
  }

  .main-collection__grid-item:nth-child(7) {
    animation-delay: 0.35s;
  }

  .main-collection__grid-item:nth-child(8) {
    animation-delay: 0.4s;
  }

  .main-collection__grid-item:nth-child(9) {
    animation-delay: 0.45s;
  }

  /* Items beyond the 9th don't animate */
  .main-collection__grid-item:nth-child(n+10) {
    opacity: 1;
    animation: none;
  }

  /* Empty State */
  .main-collection__empty {
    padding: 4rem 2rem;
    text-align: center;
    font-family: var(--font-body-family);
    font-size: 1rem;
    color: var(--color-foreground);
    opacity: 0.7;
  }

  /* Pagination */
  .main-collection__pagination {
    margin-top: 3rem;
    display: flex;
    justify-content: center;
    gap: 1rem;
  }

  .main-collection__pagination a,
  .main-collection__pagination span {
    font-family: var(--font-body-family);
    font-size: 0.875rem;
    padding: 0.5rem 0.75rem;
    text-decoration: none;
    color: var(--color-foreground);
    opacity: 0.6;
    transition: opacity 0.3s ease;
  }

  .main-collection__pagination a:hover {
    opacity: 1;
  }

  .main-collection__pagination span.current {
    opacity: 1;
    font-weight: 500;
  }

  /* Mobile sidebar toggle - for future enhancement */
  @media screen and (max-width: 989px) {
    .main-collection__sidebar--left,
    .main-collection__sidebar--right {
      display: none;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Collection products",
  "tag": "section",
  "class": "section-main-collection",
  "enabled_on": {
    "templates": ["collection"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Product grid"
    },
    {
      "type": "range",
      "id": "products_per_row",
      "label": "Products per row",
      "min": 2,
      "max": 4,
      "step": 1,
      "default": 3
    },
    {
      "type": "range",
      "id": "products_per_page",
      "label": "Products per page",
      "min": 8,
      "max": 48,
      "step": 4,
      "default": 24
    },
    {
      "type": "range",
      "id": "product_gap",
      "label": "Product gap",
      "min": 8,
      "max": 48,
      "step": 4,
      "unit": "px",
      "default": 24
    },
    {
      "type": "header",
      "content": "Sidebars"
    },
    {
      "type": "text",
      "id": "designers_title",
      "label": "Designers sidebar title",
      "default": "Designers"
    },
    {
      "type": "text",
      "id": "categories_title",
      "label": "Categories sidebar title",
      "default": "Categories"
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Top padding",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 48
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Bottom padding",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 48
    }
  ]
}
{% endschema %}
