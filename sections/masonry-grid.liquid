{%- comment -%}
  Masonry Grid Section
  A flexible grid with cards that can be full width or half width
  Supports collection selectors and custom links with overlaid titles
  Optional modal view with navigation
{%- endcomment -%}

{%- liquid
  assign section_id = section.id
  assign gap = section.settings.gap
  assign card_height = section.settings.card_height
  assign card_height_mobile = section.settings.card_height_mobile
  assign title_position_horizontal = section.settings.title_position_horizontal
  assign title_position_vertical = section.settings.title_position_vertical
  assign enable_modal = section.settings.enable_modal
  assign full_bleed = section.settings.full_bleed
  assign remove_main_padding_top = section.settings.remove_main_padding_top
-%}

{%- if remove_main_padding_top -%}
  <style>
    #MainContent { padding-top: 0 !important; }
  </style>
{%- endif -%}

<section
  id="MasonryGrid-{{ section_id }}"
  class="masonry-grid{% if full_bleed %} masonry-grid--full-bleed{% endif %}"
  style="
    --masonry-gap: {{ gap }}px;
    --masonry-card-height: {{ card_height }}vw;
    --masonry-card-height-mobile: {{ card_height_mobile }}px;
    --padding-block-start: {{ section.settings.padding_top }}px;
    --padding-block-end: {{ section.settings.padding_bottom }}px;
  "
  data-masonry-grid
  data-modal-enabled="{{ enable_modal }}"
>
  {%- if section.settings.heading != blank -%}
    <header class="masonry-grid__header">
      <h2 class="masonry-grid__heading">{{ section.settings.heading }}</h2>
      {%- if section.settings.description != blank -%}
        <p class="masonry-grid__description">{{ section.settings.description }}</p>
      {%- endif -%}
    </header>
  {%- endif -%}

  <div class="masonry-grid__container">
    {%- for block in section.blocks -%}
      {%- liquid
        assign card_width = block.settings.card_width
        assign card_class = 'masonry-grid__card'
        if card_width == 'full'
          assign card_class = card_class | append: ' masonry-grid__card--full'
        else
          assign card_class = card_class | append: ' masonry-grid__card--half'
        endif
      -%}

      {%- case block.type -%}
        {%- when 'collection' -%}
          {%- liquid
            assign collection = block.settings.collection
            assign card_image = block.settings.image | default: collection.image | default: collection.products.first.featured_image
            assign card_title = block.settings.custom_title | default: collection.title | default: 'Collection'
            assign card_description = block.settings.description | default: collection.description
            assign card_link = collection.url | default: '#'
            assign title_color = block.settings.title_color
          -%}

          {%- if enable_modal -%}
            <button
              type="button"
              class="{{ card_class }}"
              data-masonry-card
              data-card-index="{{ forloop.index0 }}"
              data-card-title="{{ card_title | escape }}"
              data-card-description="{{ card_description | escape }}"
              data-card-image="{{ card_image | image_url: width: 1600 }}"
              data-card-link="{{ card_link }}"
              {{ block.shopify_attributes }}
            >
          {%- else -%}
            <a
              href="{{ card_link }}"
              class="{{ card_class }}"
              {{ block.shopify_attributes }}
            >
          {%- endif -%}
            <div class="masonry-grid__card-image">
              {%- if card_image != blank -%}
                <img
                  src="{{ card_image | image_url: width: 1200 }}"
                  srcset="
                    {{ card_image | image_url: width: 600 }} 600w,
                    {{ card_image | image_url: width: 900 }} 900w,
                    {{ card_image | image_url: width: 1200 }} 1200w,
                    {{ card_image | image_url: width: 1600 }} 1600w
                  "
                  sizes="(max-width: 749px) 100vw, {{ card_width | replace: 'half', '50vw' | replace: 'full', '100vw' }}"
                  alt="{{ card_image.alt | default: card_title | escape }}"
                  loading="lazy"
                  width="{{ card_image.width }}"
                  height="{{ card_image.height }}"
                >
              {%- else -%}
                {{ 'collection-1' | placeholder_svg_tag: 'masonry-grid__placeholder' }}
              {%- endif -%}
            </div>
            <div class="masonry-grid__card-overlay"></div>
            <div class="masonry-grid__card-content masonry-grid__card-content--h-{{ title_position_horizontal }} masonry-grid__card-content--v-{{ title_position_vertical }}"{% if title_color != 'auto' %} style="color: {{ title_color }};"{% endif %}>
              <span class="masonry-grid__card-title">{{ card_title }}</span>
              {%- if block.settings.show_product_count and collection != blank -%}
                <span class="masonry-grid__card-count">{{ collection.products_count }} {{ 'collections.general.items' | t }}</span>
              {%- endif -%}
            </div>
          {%- if enable_modal -%}
            </button>
          {%- else -%}
            </a>
          {%- endif -%}

        {%- when 'custom_image' -%}
          {%- liquid
            assign card_image = block.settings.image
            assign card_title = block.settings.title | default: 'Link'
            assign card_description = block.settings.description
            assign card_link = block.settings.url | default: '#'
            assign open_new_tab = block.settings.open_new_tab
            assign title_color = block.settings.title_color
          -%>

          {%- if enable_modal -%}
            <button
              type="button"
              class="{{ card_class }}"
              data-masonry-card
              data-card-index="{{ forloop.index0 }}"
              data-card-title="{{ card_title | escape }}"
              data-card-description="{{ card_description | escape }}"
              data-card-image="{{ card_image | image_url: width: 1600 }}"
              data-card-link="{{ card_link }}"
              {{ block.shopify_attributes }}
            >
          {%- else -%}
            <a
              href="{{ card_link }}"
              class="{{ card_class }}"
              {% if open_new_tab %}target="_blank" rel="noopener noreferrer"{% endif %}
              {{ block.shopify_attributes }}
            >
          {%- endif -%}
            <div class="masonry-grid__card-image">
              {%- if card_image != blank -%}
                <img
                  src="{{ card_image | image_url: width: 1200 }}"
                  srcset="
                    {{ card_image | image_url: width: 600 }} 600w,
                    {{ card_image | image_url: width: 900 }} 900w,
                    {{ card_image | image_url: width: 1200 }} 1200w,
                    {{ card_image | image_url: width: 1600 }} 1600w
                  "
                  sizes="(max-width: 749px) 100vw, {{ card_width | replace: 'half', '50vw' | replace: 'full', '100vw' }}"
                  alt="{{ card_image.alt | default: card_title | escape }}"
                  loading="lazy"
                  width="{{ card_image.width }}"
                  height="{{ card_image.height }}"
                >
              {%- else -%}
                {{ 'collection-1' | placeholder_svg_tag: 'masonry-grid__placeholder' }}
              {%- endif -%}
            </div>
            <div class="masonry-grid__card-overlay"></div>
            <div class="masonry-grid__card-content masonry-grid__card-content--h-{{ title_position_horizontal }} masonry-grid__card-content--v-{{ title_position_vertical }}"{% if title_color != 'auto' %} style="color: {{ title_color }};"{% endif %}>
              <span class="masonry-grid__card-title">{{ card_title }}</span>
              {%- if block.settings.subtitle != blank -%}
                <span class="masonry-grid__card-subtitle">{{ block.settings.subtitle }}</span>
              {%- endif -%}
            </div>
          {%- if enable_modal -%}
            </button>
          {%- else -%}
            </a>
          {%- endif -%}
      {%- endcase -%}
    {%- else -%}
      {%- comment -%} Placeholder cards when no blocks are added {%- endcomment -%}
      {%- for i in (1..4) -%}
        <div class="masonry-grid__card masonry-grid__card--{% cycle 'half', 'half', 'full', 'half' %} masonry-grid__card--placeholder">
          <div class="masonry-grid__card-image">
            {{ 'collection-1' | placeholder_svg_tag: 'masonry-grid__placeholder' }}
          </div>
          <div class="masonry-grid__card-overlay"></div>
          <div class="masonry-grid__card-content masonry-grid__card-content--h-{{ title_position_horizontal }} masonry-grid__card-content--v-{{ title_position_vertical }}">
            <span class="masonry-grid__card-title">Card {{ i }}</span>
          </div>
        </div>
      {%- endfor -%}
    {%- endfor -%}
  </div>

  {%- if enable_modal -%}
    {%- comment -%} Modal for card details {%- endcomment -%}
    <div class="masonry-modal" data-masonry-modal aria-hidden="true" role="dialog" aria-modal="true">
      <div class="masonry-modal__backdrop" data-modal-close></div>
      <div class="masonry-modal__container">
        <button type="button" class="masonry-modal__close" data-modal-close aria-label="Close modal">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>

        <button type="button" class="masonry-modal__nav masonry-modal__nav--prev" data-modal-prev aria-label="Previous">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>

        <div class="masonry-modal__content">
          <div class="masonry-modal__image-wrapper">
            <img class="masonry-modal__image" data-modal-image src="" alt="">
          </div>
          <div class="masonry-modal__details">
            <h3 class="masonry-modal__title" data-modal-title></h3>
            <p class="masonry-modal__description" data-modal-description></p>
            <a href="#" class="masonry-modal__link" data-modal-link>
              View details
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="5" y1="12" x2="19" y2="12"></line>
                <polyline points="12 5 19 12 12 19"></polyline>
              </svg>
            </a>
          </div>
        </div>

        <button type="button" class="masonry-modal__nav masonry-modal__nav--next" data-modal-next aria-label="Next">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
    </div>
  {%- endif -%}
</section>

<script>
  (function() {
    const section = document.getElementById('MasonryGrid-{{ section_id }}');
    if (!section) return;

    const modalEnabled = section.dataset.modalEnabled === 'true';
    if (!modalEnabled) return;

    const modal = section.querySelector('[data-masonry-modal]');
    const cards = section.querySelectorAll('[data-masonry-card]');
    const modalImage = modal.querySelector('[data-modal-image]');
    const modalTitle = modal.querySelector('[data-modal-title]');
    const modalDescription = modal.querySelector('[data-modal-description]');
    const modalLink = modal.querySelector('[data-modal-link]');
    const closeButtons = modal.querySelectorAll('[data-modal-close]');
    const prevButton = modal.querySelector('[data-modal-prev]');
    const nextButton = modal.querySelector('[data-modal-next]');

    let currentIndex = 0;
    const totalCards = cards.length;

    function openModal(index) {
      currentIndex = index;
      updateModalContent();
      modal.setAttribute('aria-hidden', 'false');
      modal.classList.add('masonry-modal--open');
      document.body.style.overflow = 'hidden';
      
      // Focus trap
      modal.querySelector('[data-modal-close]').focus();
    }

    function closeModal() {
      modal.setAttribute('aria-hidden', 'true');
      modal.classList.remove('masonry-modal--open');
      document.body.style.overflow = '';
      
      // Return focus to the card that opened the modal
      cards[currentIndex]?.focus();
    }

    function updateModalContent() {
      const card = cards[currentIndex];
      if (!card) return;

      const title = card.dataset.cardTitle || '';
      const description = card.dataset.cardDescription || '';
      const image = card.dataset.cardImage || '';
      const link = card.dataset.cardLink || '#';

      modalImage.src = image;
      modalImage.alt = title;
      modalTitle.textContent = title;
      modalDescription.textContent = description;
      modalLink.href = link;

      // Hide link if no valid URL
      modalLink.style.display = link && link !== '#' ? 'inline-flex' : 'none';

      // Update nav button states
      updateNavButtons();
    }

    function updateNavButtons() {
      prevButton.disabled = currentIndex === 0;
      nextButton.disabled = currentIndex === totalCards - 1;
      prevButton.style.opacity = currentIndex === 0 ? '0.3' : '1';
      nextButton.style.opacity = currentIndex === totalCards - 1 ? '0.3' : '1';
    }

    function goToPrev() {
      if (currentIndex > 0) {
        currentIndex--;
        updateModalContent();
      }
    }

    function goToNext() {
      if (currentIndex < totalCards - 1) {
        currentIndex++;
        updateModalContent();
      }
    }

    // Event listeners
    cards.forEach((card, index) => {
      card.addEventListener('click', () => openModal(index));
    });

    closeButtons.forEach(btn => {
      btn.addEventListener('click', closeModal);
    });

    prevButton.addEventListener('click', goToPrev);
    nextButton.addEventListener('click', goToNext);

    // Keyboard navigation
    modal.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeModal();
      } else if (e.key === 'ArrowLeft') {
        goToPrev();
      } else if (e.key === 'ArrowRight') {
        goToNext();
      }
    });

    // Close on backdrop click
    modal.querySelector('.masonry-modal__backdrop').addEventListener('click', closeModal);
  })();
</script>

{% stylesheet %}
  .masonry-grid {
    padding: var(--padding-block-start, 3rem) 1rem var(--padding-block-end, 3rem);
    background-color: var(--color-background, #fff);
  }

  @media screen and (min-width: 750px) {
    .masonry-grid {
      padding-inline: 2rem;
    }
  }

  @media screen and (min-width: 990px) {
    .masonry-grid {
      padding-inline: 3rem;
    }
  }

  .masonry-grid__header {
    text-align: center;
    margin-bottom: 2rem;
    max-width: 800px;
    margin-inline: auto;
  }

  @media screen and (min-width: 750px) {
    .masonry-grid__header {
      margin-bottom: 3rem;
    }
  }

  .masonry-grid__heading {
    font-family: var(--font-heading-family);
    font-size: var(--section-heading-md);
    font-weight: var(--font-heading-weight, 400);
    line-height: 1.2;
    margin: 0 0 0.75rem;
    color: var(--color-foreground);
  }

  @media screen and (min-width: 750px) {
    .masonry-grid__heading {
      font-size: var(--section-heading-md-desktop);
    }
  }

  .masonry-grid__description {
    font-family: var(--font-body-family);
    font-size: 1rem;
    line-height: 1.6;
    margin: 0;
    color: var(--color-foreground);
    opacity: 0.8;
  }

  .masonry-grid__container {
    display: flex;
    flex-wrap: wrap;
    gap: var(--masonry-gap, 16px);
    max-width: 1600px;
    margin: 0 auto;
  }

  .masonry-grid__card {
    position: relative;
    display: block;
    height: var(--masonry-card-height-mobile, 300px);
    overflow: hidden;
    text-decoration: none;
    color: #fff;
    flex-shrink: 0;
    border: none;
    padding: 0;
    background: none;
    cursor: pointer;
    text-align: left;
    opacity: 0;
    animation: fadeInUp 0.6s var(--animation-easing, ease) both;
  }

  /* Fade sequence animation for first items */
  .masonry-grid__card:nth-child(1) {
    animation-delay: 0.05s;
  }

  .masonry-grid__card:nth-child(2) {
    animation-delay: 0.1s;
  }

  .masonry-grid__card:nth-child(3) {
    animation-delay: 0.15s;
  }

  .masonry-grid__card:nth-child(4) {
    animation-delay: 0.2s;
  }

  .masonry-grid__card:nth-child(5) {
    animation-delay: 0.25s;
  }

  .masonry-grid__card:nth-child(6) {
    animation-delay: 0.3s;
  }

  .masonry-grid__card:nth-child(7) {
    animation-delay: 0.35s;
  }

  .masonry-grid__card:nth-child(8) {
    animation-delay: 0.4s;
  }

  .masonry-grid__card:nth-child(9) {
    animation-delay: 0.45s;
  }

  /* Items beyond the 9th don't animate */
  .masonry-grid__card:nth-child(n+10) {
    opacity: 1;
    animation: none;
  }

  /* Full width card */
  .masonry-grid__card--full {
    width: 100%;
  }

  /* Half width card */
  .masonry-grid__card--half {
    width: 100%;
  }

  @media screen and (min-width: 750px) {
    .masonry-grid__card {
      height: var(--masonry-card-height, 450px);
    }

    .masonry-grid__card--half {
      width: calc(50% - var(--masonry-gap, 16px) / 2);
    }
  }

  .masonry-grid__card-image {
    position: absolute;
    inset: 0;
  }

  .masonry-grid__card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .masonry-grid__card:hover .masonry-grid__card-image img {
    transform: scale(1.05);
  }

  .masonry-grid__placeholder {
    width: 100%;
    height: 100%;
    object-fit: cover;
    fill: #666;
    background-color: #e8e8e8;
  }

  .masonry-grid__card-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      180deg,
      rgba(0, 0, 0, 0.05) 0%,
      rgba(0, 0, 0, 0.35) 100%
    );
    pointer-events: none;
    transition: opacity 0.3s ease;
  }

  .masonry-grid__card:hover .masonry-grid__card-overlay {
    opacity: 0.85;
  }

  .masonry-grid__card-content {
    position: absolute;
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
    padding: 1.25rem;
    z-index: 1;
    max-width: 80%;
  }

  /* Horizontal positioning */
  .masonry-grid__card-content--h-left {
    left: 0;
    align-items: flex-start;
    text-align: left;
  }

  .masonry-grid__card-content--h-center {
    left: 50%;
    transform: translateX(-50%);
    align-items: center;
    text-align: center;
  }

  .masonry-grid__card-content--h-right {
    right: 0;
    align-items: flex-end;
    text-align: right;
  }

  /* Vertical positioning */
  .masonry-grid__card-content--v-top {
    top: 0;
  }

  .masonry-grid__card-content--v-center {
    top: 50%;
    transform: translateY(-50%);
  }

  .masonry-grid__card-content--h-center.masonry-grid__card-content--v-center {
    transform: translate(-50%, -50%);
  }

  .masonry-grid__card-content--v-bottom {
    bottom: 0;
  }

  @media screen and (min-width: 750px) {
    .masonry-grid__card-content {
      padding: 1.75rem;
    }
  }

  .masonry-grid__card-title {
    font-family: var(--font-heading-family);
    font-size: 1.125rem;
    font-weight: 400;
    line-height: 1.3;
    color: #fff;
    text-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
    letter-spacing: 0.01em;
  }

  @media screen and (min-width: 750px) {
    .masonry-grid__card-title {
      font-size: 1.375rem;
    }
  }

  @media screen and (min-width: 990px) {
    .masonry-grid__card-title {
      font-size: 1.625rem;
    }
  }

  .masonry-grid__card-subtitle,
  .masonry-grid__card-count {
    font-family: var(--font-body-family);
    font-size: 0.75rem;
    font-weight: 400;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    opacity: 0.85;
    color: #fff;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.25);
  }

  /* Modal Styles */
  .masonry-modal {
    position: fixed;
    inset: 0;
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .masonry-modal--open {
    opacity: 1;
    visibility: visible;
  }

  .masonry-modal__backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.9);
    cursor: pointer;
  }

  .masonry-modal__container {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    max-width: 1400px;
    padding: 1rem;
  }

  @media screen and (min-width: 750px) {
    .masonry-modal__container {
      padding: 2rem;
    }
  }

  .masonry-modal__close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    padding: 0;
    border: none;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    color: #fff;
    cursor: pointer;
    transition: background 0.2s ease, transform 0.2s ease;
  }

  .masonry-modal__close:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.05);
  }

  @media screen and (min-width: 750px) {
    .masonry-modal__close {
      top: 2rem;
      right: 2rem;
    }
  }

  .masonry-modal__nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    padding: 0;
    border: none;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    color: #fff;
    cursor: pointer;
    transition: background 0.2s ease, opacity 0.2s ease, transform 0.2s ease;
  }

  .masonry-modal__nav:hover:not(:disabled) {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-50%) scale(1.05);
  }

  .masonry-modal__nav:disabled {
    cursor: not-allowed;
  }

  .masonry-modal__nav--prev {
    left: 0.5rem;
  }

  .masonry-modal__nav--next {
    right: 0.5rem;
  }

  @media screen and (min-width: 750px) {
    .masonry-modal__nav {
      width: 56px;
      height: 56px;
    }

    .masonry-modal__nav--prev {
      left: 1rem;
    }

    .masonry-modal__nav--next {
      right: 1rem;
    }
  }

  @media screen and (min-width: 990px) {
    .masonry-modal__nav--prev {
      left: 2rem;
    }

    .masonry-modal__nav--next {
      right: 2rem;
    }
  }

  .masonry-modal__content {
    position: relative;
    display: flex;
    flex-direction: column;
    max-width: 900px;
    max-height: 90vh;
    width: 100%;
    background: var(--color-background, #fff);
    overflow: hidden;
  }

  @media screen and (min-width: 990px) {
    .masonry-modal__content {
      flex-direction: row;
      max-height: 80vh;
    }
  }

  .masonry-modal__image-wrapper {
    position: relative;
    flex: 1 1 60%;
    min-height: 200px;
    max-height: 50vh;
    background: #f5f5f5;
  }

  @media screen and (min-width: 990px) {
    .masonry-modal__image-wrapper {
      max-height: none;
      min-height: 400px;
    }
  }

  .masonry-modal__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .masonry-modal__details {
    flex: 1 1 40%;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    padding: 1.5rem;
    overflow-y: auto;
  }

  @media screen and (min-width: 750px) {
    .masonry-modal__details {
      padding: 2rem;
      gap: 1.25rem;
    }
  }

  @media screen and (min-width: 990px) {
    .masonry-modal__details {
      padding: 2.5rem;
      justify-content: center;
    }
  }

  .masonry-modal__title {
    font-family: var(--font-heading-family);
    font-size: 1.5rem;
    font-weight: 400;
    line-height: 1.3;
    margin: 0;
    color: var(--color-foreground, #1a1a1a);
  }

  @media screen and (min-width: 750px) {
    .masonry-modal__title {
      font-size: 1.875rem;
    }
  }

  .masonry-modal__description {
    font-family: var(--font-body-family);
    font-size: 0.9375rem;
    line-height: 1.7;
    margin: 0;
    color: var(--color-foreground, #1a1a1a);
    opacity: 0.8;
  }

  @media screen and (min-width: 750px) {
    .masonry-modal__description {
      font-size: 1rem;
    }
  }

  .masonry-modal__link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.5rem;
    font-family: var(--font-body-family);
    font-size: 0.875rem;
    font-weight: 500;
    letter-spacing: 0.02em;
    text-decoration: none;
    color: var(--color-foreground, #1a1a1a);
    transition: gap 0.2s ease;
  }

  .masonry-modal__link:hover {
    gap: 0.75rem;
  }

  .masonry-modal__link svg {
    transition: transform 0.2s ease;
  }

  .masonry-modal__link:hover svg {
    transform: translateX(2px);
  }

  /* Full-bleed layout: edge-to-edge, zero spacing */
  .masonry-grid--full-bleed {
    padding: 0;
  }

  .masonry-grid--full-bleed .masonry-grid__container {
    max-width: none;
    gap: 0;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Masonry grid",
  "tag": "section",
  "class": "section-masonry-grid",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "header",
      "content": "Card layout"
    },
    {
      "type": "checkbox",
      "id": "remove_main_padding_top",
      "label": "Remove header offset from top",
      "info": "Zeroes the top padding added by the fixed header. Use when the section should start at the very top of the viewport.",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "full_bleed",
      "label": "Full-screen layout",
      "info": "Removes all spacing and padding for an edge-to-edge grid with seamless background images",
      "default": false
    },
    {
      "type": "range",
      "id": "gap",
      "label": "Gap between cards",
      "info": "Ignored when Full-screen layout is enabled",
      "min": 0,
      "max": 48,
      "step": 4,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "card_height",
      "label": "Card height (desktop)",
      "min": 10,
      "max": 100,
      "step": 5,
      "unit": "vw",
      "default": 50
    },
    {
      "type": "range",
      "id": "card_height_mobile",
      "label": "Card height (mobile)",
      "min": 200,
      "max": 600,
      "step": 25,
      "unit": "px",
      "default": 300
    },
    {
      "type": "header",
      "content": "Title position"
    },
    {
      "type": "select",
      "id": "title_position_horizontal",
      "label": "Horizontal alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "left"
    },
    {
      "type": "select",
      "id": "title_position_vertical",
      "label": "Vertical alignment",
      "options": [
        { "value": "top", "label": "Top" },
        { "value": "center", "label": "Center" },
        { "value": "bottom", "label": "Bottom" }
      ],
      "default": "bottom"
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Top padding",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 48
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Bottom padding",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 48
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Custom image",
          "info": "Overrides the collection image"
        },
        {
          "type": "text",
          "id": "custom_title",
          "label": "Custom title",
          "info": "Overrides the collection title"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description",
          "info": "Displayed in the modal. Defaults to collection description if empty"
        },
        {
          "type": "checkbox",
          "id": "show_product_count",
          "label": "Show product count",
          "default": false
        },
        {
          "type": "header",
          "content": "Card size"
        },
        {
          "type": "select",
          "id": "card_width",
          "label": "Card width",
          "options": [
            { "value": "half", "label": "Half (50%)" },
            { "value": "full", "label": "Full (100%)" }
          ],
          "default": "half"
        },
        {
          "type": "header",
          "content": "Title style"
        },
        {
          "type": "select",
          "id": "title_color",
          "label": "Title color",
          "options": [
            { "value": "auto", "label": "Auto (inherit)" },
            { "value": "black", "label": "Black" },
            { "value": "white", "label": "White" }
          ],
          "default": "auto"
        }
      ]
    },
    {
      "type": "custom_image",
      "name": "Custom image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Custom link"
        },
        {
          "type": "text",
          "id": "subtitle",
          "label": "Subtitle"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description",
          "info": "Displayed in the modal"
        },
        {
          "type": "url",
          "id": "url",
          "label": "Link"
        },
        {
          "type": "checkbox",
          "id": "open_new_tab",
          "label": "Open in new tab",
          "default": false
        },
        {
          "type": "header",
          "content": "Card size"
        },
        {
          "type": "select",
          "id": "card_width",
          "label": "Card width",
          "options": [
            { "value": "half", "label": "Half (50%)" },
            { "value": "full", "label": "Full (100%)" }
          ],
          "default": "half"
        },
        {
          "type": "header",
          "content": "Title style"
        },
        {
          "type": "select",
          "id": "title_color",
          "label": "Title color",
          "options": [
            { "value": "auto", "label": "Auto (inherit)" },
            { "value": "black", "label": "Black" },
            { "value": "white", "label": "White" }
          ],
          "default": "auto"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Masonry grid",
      "blocks": [
        { "type": "collection", "settings": { "card_width": "half" } },
        { "type": "collection", "settings": { "card_width": "half" } },
        { "type": "custom_image", "settings": { "card_width": "full", "title": "View All" } },
        { "type": "collection", "settings": { "card_width": "half" } }
      ]
    }
  ]
}
{% endschema %}
