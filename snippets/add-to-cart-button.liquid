{%- doc -%}
  Renders an "Add to cart" button with dynamic text and state. It shows different text based on whether the product can be added to the cart and provides visual feedback when an item is added.

  @param {boolean} can_add_to_cart - Whether the product can be added to the cart.
  @param {string} add_to_cart_text - The text to display on the button.
  @param {object} product - The product object to be added to the cart.
  @param {boolean} [icon_only_on_mobile] - If `true`, only the icon is shown on mobile devices.
  @param {string} [class] - Additional CSS classes to apply to the button.
  @param {string} [id] - The ID attribute for the button.
  @param {string} [data_testid] - The data-testid attribute for testing.
{%- enddoc -%}

{%- liquid
  assign default_add_to_cart_text = 'actions.add_to_cart' | t
  assign product_variant_media = product.selected_or_first_available_variant.featured_media.preview_image | image_url: width: 100
  if product.selected_or_first_available_variant.featured_media.preview_image == blank
    assign product_variant_media = product.featured_media.preview_image | image_url: width: 100
  endif
  
  # Default to true if setting doesn't exist
  assign animation_enabled = settings.add_to_cart_animation | default: true
-%}

<add-to-cart-component
  ref="addToCartButtonContainer"
  data-product-variant-media="{{ product_variant_media }}"
  data-add-to-cart-animation="{{ animation_enabled }}"
>
  <button
    {% if id != blank %}
      id="{{ id }}"
    {% endif %}
    type="submit"
    name="add"
    ref="addToCartButton"
    on:click="/handleClick"
    class="button {{ class }}"
    {% if data_testid %}
      data-testid="{{ data_testid }}"
    {% endif %}
    {% unless can_add_to_cart %}
      disabled
    {% endunless %}
  >
    <span class="add-to-cart-text">
      {% if can_add_to_cart %}
        <span
          aria-hidden="true"
          class="svg-wrapper add-to-cart-icon"
        >
          {% render 'icon', icon: 'cart', size: 20 %}
        </span>
      {% endif %}
      <span class="add-to-cart-text__content{% if icon_only_on_mobile %} is-visually-hidden-mobile{% endif %}">
        <span>
          <span>
            {{- add_to_cart_text | default: default_add_to_cart_text -}}
          </span>
        </span>
      </span>
    </span>
    {%- comment -%} checkmark burst markup {%- endcomment -%}
    <span class="add-to-cart__added">
      <span class="svg-wrapper add-to-cart__added-icon">
        {% render 'icon', icon: 'checkmark', size: 24 %}
      </span>
    </span>
  </button>
</add-to-cart-component>

{% stylesheet %}
  add-to-cart-component {
    display: contents;
  }

  .add-to-cart-button {
    --text-speed: 0.26;
    --base-delay: calc(var(--text-speed) * 0.25);

    user-select: none;
    transition-property: color, box-shadow, background-color, scale, translate;
    transition-duration: var(--animation-speed);
    transition-timing-function: var(--ease-out-cubic, cubic-bezier(0.33, 1, 0.68, 1));
    position: relative;
    overflow: hidden;
  }

  .add-to-cart-button:active {
    scale: 0.99;
    translate: 0 1px;
  }

  .add-to-cart-text {
    display: flex;
    gap: var(--gap-2xs, 0.3rem);
    align-items: center;
    justify-content: center;
    animation-duration: var(--animation-speed);
    animation-timing-function: var(--animation-easing);
    animation-fill-mode: forwards;
    transition: opacity var(--animation-speed) var(--animation-easing),
      clip-path var(--animation-speed) var(--animation-easing),
      translate var(--animation-speed) var(--animation-easing);
    clip-path: circle(100% at 50% 50%);
  }

  .add-to-cart__added {
    position: absolute;
    top: 50%;
    left: 50%;
    translate: -50% -50%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.3rem;
    opacity: 0;
    transition: opacity var(--animation-speed) var(--animation-easing);
  }

  .add-to-cart__added-icon {
    width: 24px;
    height: 24px;
  }

  /* Added state animation */
  [data-added='true'] .add-to-cart-text {
    clip-path: circle(0% at 50% 50%);
    opacity: 0;
    translate: 0 4px;
  }

  [data-added='true'] .add-to-cart__added {
    opacity: 1;
  }

  .add-to-cart-icon {
    width: var(--icon-size-sm, 1.25rem);
    height: var(--icon-size-sm, 1.25rem);
  }

  @keyframes atc-slide {
    to {
      opacity: var(--atc-opacity, 1);
      translate: 0px var(--atc-destination, 0px);
    }
  }
{% endstylesheet %}
