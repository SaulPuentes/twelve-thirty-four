{%- comment -%}
  Scripts Snippet
  Loads all required JavaScript files for the theme
{%- endcomment -%}

{%- comment -%} Module Importmap - Required for ES module imports {%- endcomment -%}
<script type="importmap">
  {
    "imports": {
      "@theme/overflow-list": "{{ 'overflow-list.js' | asset_url }}",
      "@theme/product-title": "{{ 'product-title-truncation.js' | asset_url }}",
      "@theme/component": "{{ 'component.js' | asset_url }}",
      "@theme/dialog": "{{ 'dialog.js' | asset_url }}",
      "@theme/events": "{{ 'events.js' | asset_url }}",
      "@theme/focus": "{{ 'focus.js' | asset_url }}",
      "@theme/morph": "{{ 'morph.js' | asset_url }}",
      "@theme/paginated-list": "{{ 'paginated-list.js' | asset_url }}",
      "@theme/performance": "{{ 'performance.js' | asset_url }}",
      "@theme/product-form": "{{ 'product-form.js' | asset_url }}",
      "@theme/recently-viewed-products": "{{ 'recently-viewed-products.js' | asset_url }}",
      "@theme/scrolling": "{{ 'scrolling.js' | asset_url }}",
      "@theme/section-renderer": "{{ 'section-renderer.js' | asset_url }}",
      "@theme/section-hydration": "{{ 'section-hydration.js' | asset_url }}",
      "@theme/utilities": "{{ 'utilities.js' | asset_url }}",
      "@theme/variant-picker": "{{ 'variant-picker.js' | asset_url }}",
      "@theme/media-gallery": "{{ 'media-gallery.js' | asset_url }}",
      "@theme/quick-add": "{{ 'quick-add.js' | asset_url }}",
      "@theme/paginated-list-aspect-ratio": "{{ 'paginated-list-aspect-ratio.js' | asset_url }}",
      "@theme/component-quantity-selector": "{{ 'component-quantity-selector.js' | asset_url }}",
      "@theme/comparison-slider": "{{ 'comparison-slider.js' | asset_url }}",
      "@theme/sticky-add-to-cart": "{{ 'sticky-add-to-cart.js' | asset_url }}",
      "@theme/fly-to-cart": "{{ 'fly-to-cart.js' | asset_url }}"
    }
  }
</script>

{%- comment -%} Global Theme Object - Required for JS modules {%- endcomment -%}
<script>
  const Theme = {
    translations: {
      placeholder_image: `{{ 'content.placeholder_image' | t }}`,
      added: `{{ 'actions.added' | t }}`,
      recipient_form_fields_visible: `{{ 'content.recipient_form_fields_visible' | t }}`,
      recipient_form_fields_hidden: `{{ 'content.recipient_form_fields_hidden' | t }}`,
      recipient_form_error: `{{ 'content.recipient_form_error' | t }}`,
      items_added_to_cart_one: `{{ 'content.items_added_to_cart.one' | t }}`,
      items_added_to_cart_other: `{{ 'content.items_added_to_cart.other' | t }}`,
    },
    routes: {
      cart_add_url: '{{ routes.cart_add_url | append: '.js' }}',
      cart_change_url: '{{ routes.cart_change_url }}',
      cart_update_url: '{{ routes.cart_update_url }}',
      cart_url: '{{ routes.cart_url }}',
      predictive_search_url: '{{ routes.predictive_search_url }}',
      search_url: '{{ routes.search_url }}',
    },
    template: {
      name: '{{ template }}',
    },
  };

  window.Shopify = window.Shopify || {};
  window.Shopify.routes = {
    root: '{{ routes.root_url }}',
    cart: '{{ routes.cart_url }}',
    cart_add: '{{ routes.cart_add_url }}',
    cart_change: '{{ routes.cart_change_url }}',
    cart_update: '{{ routes.cart_update_url }}',
    search: '{{ routes.search_url }}',
    predictive_search: '{{ routes.predictive_search_url }}'
  };
  window.Shopify.currency = {
    active: '{{ cart.currency.iso_code }}',
    rate: {{ cart.currency.rate | default: 1 }}
  };
  window.Shopify.locale = '{{ request.locale.iso_code }}';
</script>

{%- comment -%} Module Preloads - Critical modules for performance {%- endcomment -%}
<link rel="modulepreload" href="{{ 'utilities.js' | asset_url }}" fetchpriority="low">
<link rel="modulepreload" href="{{ 'component.js' | asset_url }}" fetchpriority="low">
<link rel="modulepreload" href="{{ 'events.js' | asset_url }}" fetchpriority="low">
<link rel="modulepreload" href="{{ 'morph.js' | asset_url }}" fetchpriority="low">

{%- comment -%} Core Module Scripts {%- endcomment -%}
<script src="{{ 'popover-polyfill.js' | asset_url }}" type="module" fetchpriority="low"></script>
<script src="{{ 'dialog.js' | asset_url }}" type="module" fetchpriority="low"></script>
<script src="{{ 'variant-picker.js' | asset_url }}" type="module" fetchpriority="low"></script>
<script src="{{ 'product-form.js' | asset_url }}" type="module" fetchpriority="low"></script>
<script src="{{ 'fly-to-cart.js' | asset_url }}" type="module" fetchpriority="low"></script>
<script src="{{ 'accordion-custom.js' | asset_url }}" type="module" fetchpriority="low"></script>
<script src="{{ 'component-quantity-selector.js' | asset_url }}" type="module" fetchpriority="low"></script>
<script src="{{ 'quick-add.js' | asset_url }}" type="module" fetchpriority="low"></script>
<script src="{{ 'slideshow.js' | asset_url }}" type="module" fetchpriority="low"></script>

{%- comment -%} Product Page Scripts {%- endcomment -%}
{%- if template == 'product' or template.name == 'product' or request.page_type == 'product' -%}
  <script src="{{ 'media-gallery.js' | asset_url }}" type="module" fetchpriority="low"></script>
  <script src="{{ 'sticky-add-to-cart.js' | asset_url }}" type="module" fetchpriority="low"></script>
  <script src="{{ 'volume-pricing.js' | asset_url }}" type="module" fetchpriority="low"></script>
{%- endif -%}

{%- comment -%} Collection/Search Scripts {%- endcomment -%}
{%- if template.name == 'collection' or template.name == 'search' -%}
  <script src="{{ 'paginated-list.js' | asset_url }}" type="module" fetchpriority="low"></script>
  <script src="{{ 'paginated-list-aspect-ratio.js' | asset_url }}" type="module" fetchpriority="low"></script>
{%- endif -%}

{%- comment -%} Global JavaScript (non-module) {%- endcomment -%}
<script src="{{ 'global.js' | asset_url }}" defer></script>

{%- comment -%} Hero Slideshow (only on homepage) {%- endcomment -%}
{%- if template == 'index' -%}
  <script src="{{ 'hero-slideshow.js' | asset_url }}" defer></script>
{%- endif -%}
