{%- comment -%}
  Slideshow Product Card Snippet
  
  Renders product information for use in slideshow sections
  
  @param product {Product} - The product object to display
  @param show_vendor {Boolean} - Whether to show vendor name
{%- endcomment -%}

{%- liquid
  assign product = product
  assign show_vendor = show_vendor | default: false
  
  if product == blank
    assign product_available = false
  else
    assign product_available = true
    assign has_variants = false
    if product.variants.size > 1
      assign has_variants = true
    endif
  endif
-%}

{%- if product_available -%}
  <div class="slideshow-product">
    <h3 class="slideshow-product__title">{{ product.title }}</h3>
    
    {%- if show_vendor and product.vendor != blank -%}
      <p class="slideshow-product__vendor">{{ product.vendor }}</p>
    {%- endif -%}
    
    {%- if product.description != blank -%}
      <div class="slideshow-product__description">
        {{ product.description | strip_html }}
      </div>
    {%- endif -%}
    
    {%- comment -%} Price and variant information {%- endcomment -%}
    <div class="slideshow-product__price-info">
      {%- assign min_price = product.price_min -%}
      {%- assign max_price = product.price_max -%}
      
      {%- if min_price != max_price -%}
        <p class="slideshow-product__price slideshow-product__price--range">
          <span class="slideshow-product__price-amount">{{ min_price | money }}</span>
          <span class="slideshow-product__price-separator">-</span>
          <span class="slideshow-product__price-amount">{{ max_price | money }}</span>
        </p>
      {%- else -%}
        <p class="slideshow-product__price">
          {%- if product.compare_at_price > product.price -%}
            <span class="slideshow-product__price-compare">{{ product.compare_at_price | money }}</span>
          {%- endif -%}
          <span class="slideshow-product__price-amount">{{ product.price | money }}</span>
        </p>
      {%- endif -%}
    </div>
    
    {%- comment -%} Variant selector and Add to Cart {%- endcomment -%}
    {%- if has_variants -%}
      <form class="slideshow-product__form" data-product-form>
        <div class="slideshow-product__variant-selector">
          <select 
            name="id" 
            class="slideshow-product__select"
            data-variant-select
          >
            {%- for variant in product.variants -%}
              <option 
                value="{{ variant.id }}" 
                {% unless variant.available %}disabled{% endunless %}
                data-price="{{ variant.price }}"
              >
                {{ variant.title }}{% unless variant.available %} - Sold out{% endunless %}
              </option>
            {%- endfor -%}
          </select>
        </div>
        
        <button 
          type="submit" 
          class="slideshow-product__add-to-cart"
          data-add-to-cart
        >
          Add to Cart
        </button>
      </form>
    {%- else -%}
      <form class="slideshow-product__form" data-product-form>
        <input type="hidden" name="id" value="{{ product.variants.first.id }}">
        <button 
          type="submit" 
          class="slideshow-product__add-to-cart"
          data-add-to-cart
          {% unless product.available %}disabled{% endunless %}
        >
          {% if product.available %}Add to Cart{% else %}Sold Out{% endif %}
        </button>
      </form>
    {%- endif -%}
    
    {%- comment -%} View product link {%- endcomment -%}
    <div class="slideshow-product__actions">
      <a href="{{ product.url }}" class="slideshow-product__link">
        View Details
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 3L11 8L6 13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </a>
    </div>
  </div>
{%- else -%}
  <div class="slideshow-product slideshow-product--empty">
    <p class="slideshow-product__empty-message">Select a product to display</p>
  </div>
{%- endif -%}

{% stylesheet %}
  .slideshow-product {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }
  
  .slideshow-product__title {
    font-family: var(--font-heading-family);
    font-size: var(--section-heading-sm, 1.5rem);
    font-weight: var(--font-heading-weight, 400);
    line-height: 1.2;
    margin: 0;
    color: var(--color-foreground);
  }
  
  @media screen and (min-width: 1024px) {
    .slideshow-product__title {
      font-size: var(--section-heading-sm-desktop, 1.875rem);
    }
  }
  
  .slideshow-product__vendor {
    font-family: var(--font-body-family);
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-foreground);
    opacity: 0.6;
    margin: 0;
  }
  
  .slideshow-product__description {
    font-family: var(--font-body-family);
    font-size: 0.9375rem;
    line-height: 1.7;
    color: var(--color-foreground);
    opacity: 0.7;
    max-width: 450px;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .slideshow-product__price-info {
    margin-top: 0.5rem;
  }
  
  .slideshow-product__price {
    font-family: var(--font-heading-family);
    font-size: 1.25rem;
    font-weight: 500;
    margin: 0 0 1rem;
    color: var(--color-foreground);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .slideshow-product__price-separator {
    opacity: 0.5;
    margin: 0 0.25rem;
  }
  
  .slideshow-product__price-compare {
    font-size: 1rem;
    text-decoration: line-through;
    opacity: 0.5;
  }
  
  .slideshow-product__form {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-top: 1rem;
  }
  
  .slideshow-product__variant-selector {
    width: 100%;
  }
  
  .slideshow-product__select {
    width: 100%;
    padding: 0.75rem 1rem;
    font-family: var(--font-body-family);
    font-size: 0.9375rem;
    color: var(--color-foreground);
    background-color: var(--color-background, #fff);
    border: 1px solid var(--color-border, rgba(0, 0, 0, 0.2));
    border-radius: 4px;
    cursor: pointer;
    transition: border-color 0.3s ease;
  }
  
  .slideshow-product__select:hover {
    border-color: var(--color-foreground);
  }
  
  .slideshow-product__select:focus {
    outline: none;
    border-color: var(--color-foreground);
  }
  
  .slideshow-product__select option:disabled {
    color: rgba(0, 0, 0, 0.3);
  }
  
  .slideshow-product__add-to-cart {
    width: 100%;
    padding: 0.875rem 1.5rem;
    font-family: var(--font-body-family);
    font-size: 0.9375rem;
    font-weight: 500;
    color: var(--color-button-text, #fff);
    background-color: var(--color-button, #000);
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: opacity 0.3s ease, transform 0.2s ease;
  }
  
  .slideshow-product__add-to-cart:hover:not(:disabled) {
    opacity: 0.9;
    transform: translateY(-1px);
  }
  
  .slideshow-product__add-to-cart:active:not(:disabled) {
    transform: translateY(0);
  }
  
  .slideshow-product__add-to-cart:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  
  .slideshow-product__actions {
    margin-top: 0.75rem;
  }
  
  .slideshow-product__link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-family: var(--font-body-family);
    font-size: 0.9375rem;
    font-weight: 500;
    color: var(--color-foreground);
    text-decoration: none;
    border-bottom: 1px solid currentColor;
    padding-bottom: 2px;
    transition: opacity 0.3s ease;
  }
  
  .slideshow-product__link:hover {
    opacity: 0.7;
  }
  
  .slideshow-product__link svg {
    transition: transform 0.3s ease;
  }
  
  .slideshow-product__link:hover svg {
    transform: translateX(4px);
  }
  
  .slideshow-product--empty {
    padding: 2rem;
    text-align: center;
    opacity: 0.5;
  }
  
  .slideshow-product__empty-message {
    font-family: var(--font-body-family);
    font-size: 0.9375rem;
    margin: 0;
  }
{% endstylesheet %}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const forms = document.querySelectorAll('[data-product-form]');
    
    forms.forEach(function(form) {
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const button = form.querySelector('[data-add-to-cart]');
        const variantId = form.querySelector('[name="id"]').value;
        
        if (!variantId) return;
        
        // Disable button during request
        const originalText = button.textContent;
        button.disabled = true;
        button.textContent = 'Adding...';
        
        // Add to cart
        fetch('/cart/add.js', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            id: variantId,
            quantity: 1
          })
        })
        .then(function(response) {
          return response.json();
        })
        .then(function(data) {
          // Success feedback
          button.textContent = 'Added!';
          
          // Trigger cart refresh (if cart drawer exists)
          if (typeof window.dispatchEvent === 'function') {
            window.dispatchEvent(new CustomEvent('cart:refresh'));
          }
          
          // Reset button after delay
          setTimeout(function() {
            button.disabled = false;
            button.textContent = originalText;
          }, 2000);
        })
        .catch(function(error) {
          console.error('Error:', error);
          button.disabled = false;
          button.textContent = 'Error - Try Again';
          
          setTimeout(function() {
            button.textContent = originalText;
          }, 3000);
        });
      });
    });
  });
</script>
